use master
go

IF EXISTS (SELECT name FROM master.dbo.sysdatabases WHERE name = 'Prova02')
	DROP DATABASE Prova02

CREATE DATABASE Prova02
go

use Prova02
go


create table tblpais (
cd_pais int primary key,
nm_pais char(50))
go
create table tblequipe (
cd_eq int primary key, 
nm_eq char(50), 
cd_pais int, 
foreign key (cd_pais) references tblpais)

create table tblpiloto (
cd_pil int primary key, 
nm_pil char(50), cd_eq int, 
cd_pais int, 
foreign key (cd_eq) references tblequipe, 
foreign key (cd_pais) references tblpais)

create table tblcircuito (
cd_cir int primary key, 
nm_cir char(50), 
cd_pais int, 
foreign key (cd_pais) references tblpais)

create table tblprova (
cd_pro int primary key, 
tp_pro int not null, 
dt_pro date not null, 
cd_cir int, 
foreign key (cd_cir) references tblcircuito)

create table tblpiloto_pos (
cd_pil int, 
cd_pro int, 
posicao int not null, 
primary key (cd_pil, cd_pro), 
foreign key (cd_pil) references tblpiloto, 
foreign key (cd_pro) references tblprova)

--- INSERTS -----

insert into tblpais (cd_pais, nm_pais) values 
(1,'Afeganist�o'),
(2,'�frica do Sul'),
(3,'Alb�nia'),
(4,'Alemanha'),
(5,'Andorra'), 
(6,'Angola'),
(7,'Anguilla'), 
(8,'Ant�rtida'), 
(9,'Ant�gua e Barbuda'), 
(10,'Ar�bia Saudita'), 
(11,'Arg�lia'),
(12,'Argentina'),
(13,'Arm�nia'), 
(14,'Aruba'),
(15,'Austr�lia'), 
(16,'�ustria'),
(17,'Azerbaij�o'),
(18,'Bahamas'),
(19,'Bahrein'), 
(20,'Bangladesh'),
(21,'Barbados'),
(22,'Belarus'), 
(23,'B�lgica'),
(24,'Belize'), 
(25,'Benin'),
(26,'Bermudas'),
(27,'Bol�via'), 
(28,'Bonaire, St. Eustatius & Saba'),
(29,'B�snia-Herzeg�vina'), 
(30,'Botsuana'),
(31,'Brasil'),
(32,'Brunei'), 
(33,'Bulg�ria'),
(34,'Burkina Faso'), 
(35,'Burundi'),
(36,'But�o'),
(37,'Cabo Verde'), 
(38,'Camar�es'),
(39,'Camboja'),
(40,'Canad�'),
(41,'Cazaquist�o'), 
(42,'Chade'),
(43,'Chile'),
(44,'China'),
(45,'Chipre'),
(46,'Cingapura'),
(47,'Col�mbia'), 
(48,'Congo'),
(49,'Cor�ia do Norte'), 
(50,'Cor�ia do Sul'),
(51,'Costa do Marfim'), 
(52,'Costa Rica'), 
(53,'Cro�cia'),
(54,'Cuba'),
(55,'Cura�ao'),
(56,'Dinamarca'), 
(57,'Djibuti'),
(58,'Dominica'), 
(59,'Egito'),
(60,'El Salvador'),
(61,'Emirados �rabes Unidos'),
(62,'Equador'),
(63,'Eritr�ia'),
(64,'Eslov�quia'),
(65,'Eslov�nia'), 
(66,'Espanha'),
(67,'Estados Unidos'), 
(68,'Est�nia'),
(69,'Eti�pia'),
(70,'Federa��o Russa'), 
(71,'Fiji'),
(72,'Filipinas'),
(73,'Finl�ndia'), 
(74,'Fran�a'),
(75,'Gab�o'),
(76,'G�mbia'), 
(77,'Gana'),
(78,'Ge�rgia'),
(79,'Gibraltar'),
(80,'Gr�-Bretanha (Reino Unido)'),
(81,'Granada'),
(82,'Gr�cia'),
(83,'Groel�ndia'),
(84,'Guadalupe'),
(85,'Guam (Territ�rio dos Estados Unidos)'),
(86,'Guatemala'),
(87,'Guernsey'), 
(88,'Guiana'), 
(89,'Guiana Francesa'), 
(90,'Guin�'),
(91,'Guin� Equatorial'), 
(92,'Guin�-Bissau'),
(93,'Haiti'),
(94,'Holanda'),
(95,'Honduras'),
(96,'Hong Kong'), 
(97,'Hungria'), 
(98,'I�men'),
(99,'Ilha Bouvet (Territ�rio da Noruega)'), 
(100,'Ilha do Homem'), 
(101,'Ilha Natal'),
(102,'Ilha Pitcairn'),
(103,'Ilha Reuni�o'),
(104,'Ilhas Aland'),
(105,'Ilhas Cayman'),
(106,'Ilhas Cocos'),
(107,'Ilhas Comores'), 
(108,'Ilhas Cook'),
(109,'Ilhas Faroes'),
(110,'Ilhas Falkland (Malvinas)'),
(111,'Ilhas Ge�rgia do Sul e Sandwich do Sul'),
(112,'Ilhas Heard e McDonald (Territ�rio da Austr�lia)'), 
(113,'Ilhas Marianas do Norte'), 
(114,'Ilhas Marshall'),
(115,'Ilhas Menores dos Estados Unidos'), 
(116,'Ilhas Norfolk'),
(117,'Ilhas Seychelles'), 
(118,'Ilhas Salom�o'),
(119,'Ilhas Svalbard e Jan Mayen'),
(120,'Ilhas Tokelau'),
(121,'Ilhas Turks & Caicos'),
(122,'Ilhas Virgens (Estados Unidos)'), 
(123,'Ilhas Virgens (Inglaterra)'), 
(124,'Ilhas Wallis & Futuna'), 
(125,'�ndia'),
(126,'Indon�sia'), 
(127,'Ir�'),
(128,'Iraque'),
(129,'Irlanda'),
(130,'Isl�ndia'), 
(131,'Israel'),
(132,'It�lia'),
(133,'Jamaica'), 
(134,'Jap�o'),
(135,'Jersey'),
(136,'Jord�nia'),
(137,'Kiribati'), 
(138,'Kuait'),
(139,'Laos'),
(140,'L�tvia'),
(141,'Lesoto'),
(142,'L�bano'), 
(143,'Lib�ria'), 
(144,'L�bia'),
(145,'Liechtenstein'), 
(146,'Litu�nia'),
(147,'Luxemburgo'), 
(148,'Macau'),
(149,'Maced�nia (Rep�blica Yugoslava)'), 
(150,'Madagascar'), 
(151,'Mal�sia'),
(152,'Malaui'),
(153,'Maldivas'), 
(154,'Mali'),
(155,'Malta'),
(156,'Marrocos'),
(157,'Martinica'),
(158,'Maur�cio'),
(159,'Maurit�nia'), 
(160,'Mayotte'),
(161,'M�xico'),
(162,'Micron�sia'),
(163,'Mo�ambique'), 
(164,'Moldova'),
(165,'M�naco'),
(166,'Mong�lia'),
(167,'Montenegro'),
(168,'Montserrat'), 
(169,'Myanmar'),
(170,'Nam�bia'), 
(171,'Nauru'),
(172,'Nepal'),
(173,'Nicar�gua'), 
(174,'N�ger'),
(175,'Nig�ria'), 
(176,'Niue'),
(177,'Noruega'),
(178,'Nova Caled�nia'),
(179,'Nova Zel�ndia'), 
(180,'Om�'),
(181,'Palau'),
(182,'Panam�'),
(183,'Papua-Nova Guin�'), 
(184,'Paquist�o'),
(185,'Paraguai'), 
(186,'Peru'),
(187,'Polin�sia Francesa'), 
(188,'Pol�nia'),
(189,'Porto Rico'), 
(190,'Portugal'), 
(191,'Qatar'),
(192,'Qu�nia'),
(193,'Quirguist�o'),
(194,'Rep�blica Centro-Africana'),
(195,'Rep�blica Democr�tica do Congo'), 
(196,'Rep�blica Dominicana'), 
(197,'Rep�blica Tcheca'), 
(198,'Rom�nia'),
(199,'Ruanda'),
(200,'Saara Ocidental'),
(201,'Saint Vincent & Granadinas'), 
(202,'Samoa Ocidental'),
(203,'Samoa Ocidental'), 
(204,'San Marino'),
(205,'Santa Helena'),
(206,'Santa L�cia'),
(207,'S�o Bartolomeu'),
(208,'S�o Crist�v�o e N�vis'), 
(209,'San Martin'),
(210,'S�o Tom� e Pr�ncipe'),
(211,'Senegal'),
(212,'Serra Leoa'),
(213,'S�rvia'),
(214,'S�ria'),
(215,'Som�lia'),
(216,'Sri Lanka'),
(217,'St. Maarten'),
(218,'St. Pierre & Miquelon'), 
(219,'Suazil�ndia'),
(220,'Sud�o'),
(221,'Sud�o do Sul'),
(222,'Su�cia'),
(223,'Su��a'),
(224,'Suriname'),
(225,'Tadjiquist�o'), 
(226,'Tail�ndia'), 
(227,'Taiwan'),
(228,'Tanz�nia'),
(229,'Territ�rio Brit�nico do Oceano �ndico'), 
(230,'Territ�rios do Sul da Fran�a'),
(231,'Territ�rios Palestinos Ocupados'), 
(232,'Timor Leste'), 
(233,'Togo'),
(234,'Tonga'),
(235,'Trinidad & Tobago'),
(236,'Tun�sia'),
(237,'Turcomenist�o'), 
(238,'Turquia'),
(239,'Tuvalu'),
(240,'Ucr�nia'),
(241,'Uganda'),
(242,'Uruguai'),
(243,'Uzbequist�o'), 
(244,'Vanuatu'),
(245,'Vaticano'),
(246,'Venezuela'), 
(247,'Vietn�'),
(248,'Z�mbia'),
(249,'Zimb�bue')



insert into tblequipe (cd_eq, nm_eq, cd_pais)
 values (01, 'Red Bull Racing', 80),
 (02, 'Mc Laren', 80),
 (03, 'Ferrari', 132),
 (04, 'Mercedes', 80),
 (05, 'Lotus', 80),
 (06, 'Force India', 80),
 (07, 'Sauber', 223),
 (08, 'Toro Rosso', 132),
 (09, 'Williams', 80),
 (10, 'Caterham', 80),
 (11, 'HRT', 66),
 (12, 'Marussia', 80)
go
insert into tblpiloto (cd_pil, nm_pil, cd_eq, cd_pais)
 values (01,'Sebastian Vettel', 01, 04),
 (02, 'Mark Webber', 01, 15),
 (03,'Jenson Button', 02, 123),
 (04,'Lewis Hamilton', 02, 123),
 (05,'Fernando Alonso', 03, 66),
 (06,'Felipe Massa', 03, 31),
 (07,'Michael Schumacher', 04, 04),
 (08,'Nico Rosberg', 04, 04),
 (09,'Kimi R�ikk�nen', 05, 73),
 (10,'Romain Grosjean', 05, 74),
 (11,'Paul di Resta', 06, 123),
 (12,'Nico Hulkenberg', 06, 04),
 (13,'Kamui kobayashi', 07, 134),
 (14,'Sergio Perez', 07, 161),
 (15,'Daniel Ricciardo', 11, 15),
 (16,'Jean-Eric Vergne', 08, 74),
 (17,'Pastor Maldonado', 09, 246),
 (18,'Bruno Senna', 10, 31),
 (19,'Heikki Kovalainen', 05, 73),
 (20,'Jarno Trulli', 05, 132),
 (21,'Pedro de la Rosa', 07, 66),
 (22,'Timo Glock', 12, 04),
 (23,'Charles Pic', 12, 74),
 (24, 'Vitaly Petrov', 10, 70),
 (25, 'Nick Heidfeld', 10, 04),
 (26, 'Adrian Sutil', 06, 04),
 (27, 'Jaime Alguersuario', 08, 04),
 (28, 'Sebastien Buemi', 08, 04),
 (29, 'Rubens Barrichello',09, 31),
 (30, 'Vitantonio Liuzzi', 11, 132),
 (31, 'Jerome d Ambrosio', 12, 23),
 (32, 'Narain Karthikeyan', 11, 125),
 (33, 'Karun Chandhok', 11, 125)
go
insert into tblcircuito (cd_cir, nm_cir, cd_pais)
values (01, 'Albert Park', 15),
(02, 'Circuito Internacional Sepang', 151),
(03, 'Circuito Internacional Shanghai', 44),
(04, 'Instanbul Park', 238),
(05, 'Circuito da Catalunya', 66),
(06, 'Circuito de M�naco', 165),
(07, 'Circuito Gilles Villeneuve', 40),
(08, 'Circuito de rua de Val�ncia', 66),
(09, 'Circuito Silverstone', 123),
(10, 'N�rburgring', 04),
(11, 'Hungaroring', 97),
(12, 'Circuito de Spa-Francorchamps', 23),
(13, 'Aut�dromo Nacional de Monza', 132),
(14, 'Circuito de rua Marina Bay', 46),
(15, 'Circuito Suzuka', 134),
(16, 'Circuito Internacional Coreano', 50),
(17, 'Circuito Internacional Buddh', 125),
(18, 'Circuito Internacional Yas Marina', 61),
(19, 'Aut�dromo Jos� Carlos Pace', 31)
go
insert into tblprova (cd_pro,tp_pro, dt_pro, cd_cir)
values (01, 89, '27/03/2011', 01),
(02, 97, '10/04/2011', 02),
(03, 96, '17/04/2011', 03),
(04, 90, '08/05/2011', 04),
(05, 99, '22/05/2011', 05),
(06, 69, '29/05/2011', 06),
(07, 244, '12/06/2011', 07),
(08, 99, '26/06/2011', 08),
(09, 88, '10/07/2011', 09),
(10, 97, '24/07/2011', 10),
(11, 106, '31/07/2011', 11),
(12, 86, '28/08/2011', 12),
(13, 80, '11/09/2011', 13),
(14, 119, '25/09/2011', 14),
(15, 90, '09/10/2011', 15),
(16, 98, '16/10/2011', 16),
(17, 90, '30/10/2011', 17),
(18, 97, '13/11/2011', 18),
(19, 92, '27/11/2011', 19);
go
insert into tblpiloto_pos (cd_pil,cd_pro, posicao)
values (01, 01, 01),
(04, 01, 02),
(24, 01, 03),
(05, 01, 04),
(02, 01, 05),
(03, 01, 06),
(06, 01, 07),
(28, 01, 08),
(26, 01, 09),
(11, 01, 10),
(27, 01, 11),
(25, 01, 12),
(20, 01, 13),
(31, 01, 14),


(01, 02, 01),
(03, 02, 02),
(25, 02, 03),
(02, 02, 04),
(06, 02, 05),
(05, 02, 06),
(13, 02, 07),
(04, 02, 08),
(07, 02, 09),
(11, 02, 10),
(26, 02, 11),
(08, 02, 12),
(28, 02, 13),
(27, 02, 14),
(19, 02, 15),
(22, 02, 16),
(24, 02, 17),



(04, 03, 01),
(01, 03, 02),
(02, 03, 03),
(03, 03, 04),
(12, 03, 05),
(06, 03, 06),
(05, 03, 07),
(07, 03, 08),
(24, 03, 09),
(13, 03, 10),
(11, 03, 11),
(25, 03, 12),
(29, 03, 13),
(28, 03, 14),
(26, 03, 15),
(19, 03, 16),
(14, 03, 17),
(17, 03, 18),
(20, 03, 19),
(31, 03, 20),
(22, 03, 21),
(30, 03, 22),
(32, 03, 23),



(01, 04, 01),
(02, 04, 02),
(05, 04, 03),
(04, 04, 04),
(08, 04, 05),
(03, 04, 06),
(25, 04, 07),
(24, 04, 08),
(28, 04, 09),
(13, 04, 10),
(06, 04, 11),
(07, 04, 12),
(26, 04, 13),
(14, 04, 14),
(29, 04, 15),
(27, 04, 16),
(17, 04, 17),
(20, 04, 18),
(19, 04, 19),
(31, 04, 20),
(32, 04, 21),
(30, 04, 22),


(01, 05, 01),
(04, 05, 02),
(03, 05, 03),
(02, 05, 04),
(05, 05, 05),
(07, 05, 06),
(08, 05, 07),
(25, 05, 08),
(14, 05, 09),
(13, 05, 10),
(24, 05, 11),
(11, 05, 12),
(26, 05, 13),
(28, 05, 14),
(17, 05, 15),
(27, 05, 16),
(29, 05, 17),
(20, 05, 18),
(22, 05, 19),
(31, 05, 20),
(32, 05, 21),


(01, 06, 01),
(05, 06, 02),
(03, 06, 03),
(02, 06, 04),
(13, 06, 05),
(04, 06, 06),
(26, 06, 07),
(25, 06, 08),
(29, 06, 09),
(28, 06, 10),
(08, 06, 11),
(11, 06, 12),
(20, 06, 13),
(19, 06, 14),
(31, 06, 15),
(30, 06, 16),
(32, 06, 17),
(17, 06, 18),

(03, 07, 01),
(01, 07, 02),
(02, 07, 03),
(07, 07, 04),
(24, 07, 05),
(06, 07, 06),
(13, 07, 07),
(27, 07, 08),
(29, 07, 09),
(28, 07, 10),
(08, 07, 11),
(21, 07, 12),
(30, 07, 13),
(31, 07, 14),
(22, 07, 15),
(20, 07, 16),
(32, 07, 17),
(11, 07, 18),


(01, 08, 01),
(05, 08, 02),
(02, 08, 03),
(04, 08, 04),
(06, 08, 05),
(03, 08, 06),
(08, 08, 07),
(27, 08, 08),
(26, 08, 09),
(25, 08, 10),
(14, 08, 11),
(29, 08, 12),
(28, 08, 13),
(11, 08, 14),
(24, 08, 15),
(13, 08, 16),
(07, 08, 17),
(17, 08, 18),
(19, 08, 19),
(20, 08, 20),
(22, 08, 21),
(31, 08, 22),
(30, 08, 23),
(32, 08, 24),


(05, 09, 01),
(01, 09, 02),
(02, 09, 03),
(04, 09, 04),
(06, 09, 05),
(08, 09, 06),
(14, 09, 07),
(25, 09, 08),
(07, 09, 09),
(27, 09, 10),
(26, 09, 11),
(24, 09, 12),
(29, 09, 13),
(17, 09, 14),
(11, 09, 15),
(22, 09, 16),
(31, 09, 17),
(30, 09, 18),
(15, 09, 19),


(04, 10, 01),
(05, 10, 02),
(02, 10, 03),
(01, 10, 04),
(06, 10, 05),
(26, 10, 06),
(08, 10, 07),
(07, 10, 08),
(13, 10, 09),
(24, 10, 10),
(14, 10, 11),
(27, 10, 12),
(11, 10, 13),
(17, 10, 14),
(28, 10, 15),
(19, 10, 16),
(22, 10, 17),
(31, 10, 18),
(15, 10, 19),
(33, 10, 20),


(03, 11, 01),
(01, 11, 02),
(05, 11, 03),
(04, 11, 04),
(02, 11, 05),
(06, 11, 06),
(11, 11, 07),
(28, 11, 08),
(08, 11, 09),
(27, 11, 10),
(13, 11, 11),
(24, 11, 12),
(29, 11, 13),
(26, 11, 14),
(14, 11, 15),
(17, 11, 16),
(22, 11, 17),
(15, 11, 18),
(31, 11, 19),
(30, 11, 20),


(01, 12, 01),
(02, 12, 02),
(03, 12, 03),
(05, 12, 04),
(07, 12, 05),
(08, 12, 06),
(26, 12, 07),
(06, 12, 08),
(24, 12, 09),
(17, 12, 10),
(11, 12, 11),
(13, 12, 12),
(18, 12, 13),
(20, 12, 14),
(19, 12, 15),
(29, 12, 16),
(31, 12, 17),
(22, 12, 18),
(30, 12, 19),


(01, 13, 01),
(03, 13, 02),
(05, 13, 03),
(04, 13, 04),
(07, 13, 05),
(06, 13, 06),
(27, 13, 07),
(11, 13, 08),
(18, 13, 09),
(28, 13, 10),
(17, 13, 11),
(29, 13, 12),
(19, 13, 13),
(20, 13, 14),
(22, 13, 15),


(01, 14, 01),
(03, 14, 02),
(02, 14, 03),
(05, 14, 04),
(04, 14, 05),
(11, 14, 06),
(08, 14, 07),
(26, 14, 08),
(06, 14, 09),
(14, 14, 10),
(17, 14, 11),
(28, 14, 12),
(29, 14, 13),
(13, 14, 14),
(18, 14, 15),
(19, 14, 16),
(24, 14, 17),
(31, 14, 18),
(15, 14, 19),
(30, 14, 20),
(27, 14, 21),

(03, 15, 01),
(05, 15, 02),
(01, 15, 03),
(02, 15, 04),
(04, 15, 05),
(07, 15, 06),
(06, 15, 07),
(14, 15, 08),
(24, 15, 09),
(08, 15, 10),
(26, 15, 11),
(11, 15, 12),
(13, 15, 13),
(17, 15, 14),
(27, 15, 15),
(18, 15, 16),
(29, 15, 17),
(19, 15, 18),
(20, 15, 19),
(22, 15, 20),
(31, 15, 21),
(15, 15, 22),
(30, 15, 23),

(01, 16, 01),
(04, 16, 02),
(02, 16, 03),
(03, 16, 04),
(05, 16, 05),
(06, 16, 06),
(27, 16, 07),
(08, 16, 08),
(28, 16, 09),
(11, 16, 10),
(26, 16, 11),
(29, 16, 12),
(18, 16, 13),
(19, 16, 14),
(13, 16, 15),
(14, 16, 16),
(20, 16, 17),
(22, 16, 18),
(15, 16, 19),
(31, 16, 20),
(30, 16, 21),


(01, 17, 01),
(03, 17, 02),
(05, 17, 03),
(02, 17, 04),
(07, 17, 05),
(08, 17, 06),
(04, 17, 07),
(27, 17, 08),
(26, 17, 09),
(14, 17, 10),
(24, 17, 11),
(18, 17, 12),
(11, 17, 13),
(19, 17, 14),
(29, 17, 15),
(31, 17, 16),
(32, 17, 17),
(15, 17, 18),
(20, 17, 19),

(04, 18, 01),
(05, 18, 02),
(03, 18, 03),
(02, 18, 04),
(06, 18, 05),
(08, 18, 06),
(07, 18, 07),
(26, 18, 08),
(11, 18, 09),
(13, 18, 10),
(14, 18, 11),
(29, 18, 12),
(24, 18, 13),
(17, 18, 14),
(27, 18, 15),
(18, 18, 16),
(19, 18, 17),
(20, 18, 18),
(22, 18, 19),
(30, 18, 20),


(02, 19, 01),
(01, 19, 02),
(03, 19, 03),
(05, 19, 04),
(06, 19, 05),
(26, 19, 06),
(08, 19, 07),
(11, 19, 08),
(13, 19, 09),
(24, 19, 10),
(27, 19, 11),
(28, 19, 12),
(14, 19, 13),
(29, 19, 14),
(07, 19, 15),
(19, 19, 16),
(18, 19, 17),
(20, 19, 18),
(31, 19, 19),
(15, 19, 20);

-- 1 - Subquerie de 2 níveis: Selecione os pilotos no qual possuem o código de país igual a "123"

SELECT * FROM tblpiloto WHERE cd_pais IN (SELECT cd_pais FROM tblpais) AND cd_pais = '123'

-- 2 - Subquerie de 3 níveis: Selecione as equipes junto ao código do piloto no qual tenha o código do país igual a "80" 

SELECT * FROM tblequipe WHERE nm_eq IN (SELECT nm_eq FROM tblpiloto WHERE cd_pil IN (SELECT cd_pil FROM tblpais)) AND cd_pais = '80'